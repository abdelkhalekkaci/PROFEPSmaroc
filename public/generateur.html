<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="G√©n√©rez des fiches de s√©ance, projets de cycle et grilles d'√©valuation EPS. Conforme aux OP Maroc.">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TH0Z1SGNXH"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-TH0Z1SGNXH');</script>
    <title>G√©n√©rateur EPS | Fiches, Projets, Grilles - Prof EPS Maroc</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#1a5c3a,#2e7d32);min-height:100vh}
        .container{max-width:1000px;margin:0 auto;padding:20px}
        .header{text-align:center;color:#fff;padding:15px 0}
        .header h1{font-size:1.8rem}
        .back-btn{display:inline-flex;align-items:center;gap:8px;color:#fff;text-decoration:none;padding:8px 16px;background:rgba(255,255,255,0.15);border-radius:20px;margin-bottom:15px;transition:0.3s}
        .back-btn:hover{background:rgba(255,255,255,0.25)}
        .main-card{background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3);overflow:hidden}
        .type-selector{display:flex;border-bottom:3px solid #e0e0e0}
        .type-btn{flex:1;padding:18px 10px;text-align:center;cursor:pointer;border:none;background:#f5f5f5;font-size:0.95rem;font-weight:600;color:#666;transition:0.3s}
        .type-btn:hover{background:#e8f5e9}
        .type-btn.active{background:#1a5c3a;color:#fff}
        .type-btn .icon{font-size:1.4rem;display:block;margin-bottom:5px}
        .form-section{padding:25px}
        .form-row{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:15px}
        .form-row.full{grid-template-columns:1fr}
        .form-group{display:flex;flex-direction:column}
        .form-group label{font-weight:600;color:#333;margin-bottom:6px;font-size:0.85rem}
        .form-group label span{color:#e53935}
        .form-group input,.form-group select,.form-group textarea{padding:10px 12px;border:2px solid #e0e0e0;border-radius:8px;font-size:0.95rem;transition:0.3s}
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus{border-color:#1a5c3a;outline:none}
        .form-group textarea{min-height:70px;resize:vertical}
        .conditional{display:none}
        .conditional.visible{display:block}
        .info-box{background:#e3f2fd;border-left:4px solid #2196f3;padding:12px;border-radius:0 8px 8px 0;margin-bottom:15px}
        .info-box p{color:#1565c0;font-size:0.85rem}
        .submit-btn{width:100%;padding:16px;background:linear-gradient(135deg,#1a5c3a,#2e7d32);color:#fff;border:none;border-radius:10px;font-size:1.1rem;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:10px;transition:0.3s}
        .submit-btn:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(26,92,58,0.4)}
        .submit-btn:disabled{background:#ccc;cursor:not-allowed;transform:none}
        .loading{display:none;align-items:center;gap:10px}
        .spinner{width:22px;height:22px;border:3px solid #fff;border-top-color:transparent;border-radius:50%;animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        .results{padding:25px;display:none}
        .results.visible{display:block}
        .result-box{background:#e8f5e9;border-radius:12px;padding:20px;margin-bottom:15px}
        .result-box h3{color:#1a5c3a;margin-bottom:12px;display:flex;align-items:center;gap:10px}
        .download-btn{display:inline-flex;align-items:center;gap:8px;padding:12px 25px;background:#1a5c3a;color:#fff;text-decoration:none;border-radius:8px;font-weight:600;transition:0.3s;border:none;cursor:pointer;font-size:1rem}
        .download-btn:hover{background:#145a32;transform:translateY(-2px)}
        .preview{background:#fff;border-radius:8px;padding:15px;margin-top:15px;max-height:350px;overflow-y:auto;border:2px solid #e0e0e0;font-size:0.85rem}
        .new-btn{background:#ff9800;margin-left:10px}
        .new-btn:hover{background:#f57c00}
        details summary{cursor:pointer;color:#1a5c3a;font-weight:600;padding:10px 0}
        @media(max-width:768px){.form-row{grid-template-columns:1fr}.type-selector{flex-direction:column}.type-btn{padding:12px}}
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-btn">‚Üê Retour √† l'accueil</a>
        <div class="header">
            <h1>üéØ G√©n√©rateur de Documents EPS</h1>
            <p>Fiches ‚Ä¢ Projets de cycle ‚Ä¢ Grilles</p>
        </div>
        <div class="main-card">
            <div class="type-selector">
                <button class="type-btn active" data-type="fiche"><span class="icon">üìã</span>Fiche de s√©ance</button>
                <button class="type-btn" data-type="projet"><span class="icon">üìä</span>Projet de cycle</button>
                <button class="type-btn" data-type="grille"><span class="icon">üìù</span>Grille obs./√©val.</button>
            </div>
            <form id="generatorForm" class="form-section">
                <div class="form-row">
                    <div class="form-group">
                        <label>üìä Niveau <span>*</span></label>
                        <select id="niveau" required>
                            <option value="">-- S√©lectionner --</option>
                            <optgroup label="Coll√®ge"><option value="1AC">1AC</option><option value="2AC">2AC</option><option value="3AC">3AC</option></optgroup>
                            <optgroup label="Lyc√©e"><option value="TC">TC</option><option value="1AB">1AB</option><option value="2AB">2AB</option></optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>‚öΩ APS <span>*</span></label>
                        <select id="aps" required>
                            <option value="">-- S√©lectionner --</option>
                            <optgroup label="Sports collectifs"><option value="Handball">Handball</option><option value="Football">Football</option><option value="Basketball">Basketball</option><option value="Volleyball">Volleyball</option></optgroup>
                            <optgroup label="Athl√©tisme"><option value="Course de vitesse">Course de vitesse</option><option value="Course de relais">Course de relais</option><option value="Saut en longueur">Saut en longueur</option><option value="Saut en hauteur">Saut en hauteur</option><option value="Lancer de poids">Lancer de poids</option><option value="Course de dur√©e">Course de dur√©e</option></optgroup>
                            <optgroup label="Gymnastique"><option value="Gymnastique">Gymnastique</option></optgroup>
                            <optgroup label="Sports de renvoi"><option value="Tennis de table">Tennis de table</option><option value="Badminton">Badminton</option></optgroup>
                        </select>
                    </div>
                </div>
                <div id="ficheFields" class="conditional visible">
                    <div class="form-row full">
                        <div class="form-group">
                            <label>üéØ Objectif de la s√©ance <span>*</span></label>
                            <textarea id="objectif" placeholder="Ex: Am√©liorer la passe en situation de jeu"></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>üî¢ N¬∞ S√©ance</label>
                            <select id="numeroSeance"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option></select>
                        </div>
                    </div>
                </div>
                <div id="projetFields" class="conditional">
                    <div class="info-box">
                        <p>üìå <b>Structure:</b> S1 = Test diagnostique | S2 = Le√ßon th√©orique | Derni√®re = Test bilan (m√™me dispositif que S1)</p>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>üìà Niveau √©l√®ves</label>
                            <select id="niveauEleves"><option value="debutant">üü¢ D√©butant</option><option value="moyen" selected>üü° Moyen</option><option value="avance">üü† Avanc√©</option><option value="elite">üî¥ √âlite</option></select>
                        </div>
                        <div class="form-group">
                            <label>üî¢ Nombre s√©ances</label>
                            <select id="nombreSeances"><option value="8">8</option><option value="10" selected>10</option><option value="12">12</option></select>
                        </div>
                    </div>
                </div>
                <div id="grilleFields" class="conditional">
                    <div class="form-row">
                        <div class="form-group">
                            <label>üìã Type de grille</label>
                            <select id="typeGrille"><option value="observation">üëÅÔ∏è Observation</option><option value="evaluation">üìä √âvaluation</option></select>
                        </div>
                        <div class="form-group">
                            <label>üè´ Classe</label>
                            <input type="text" id="classe" placeholder="Ex: 3AC 1">
                        </div>
                    </div>
                </div>
                <details style="margin:15px 0">
                    <summary>‚ûï Infos suppl√©mentaires</summary>
                    <div style="padding-top:10px">
                        <div class="form-row">
                            <div class="form-group"><label>üë§ Professeur</label><input type="text" id="nomProf" placeholder="Nom"></div>
                            <div class="form-group"><label>üè´ √âtablissement</label><input type="text" id="etablissement" placeholder="√âtablissement"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label>üìÖ Ann√©e</label><input type="text" id="anneeScolaire" placeholder="2024-2025"></div>
                        </div>
                    </div>
                </details>
                <button type="submit" class="submit-btn" id="submitBtn">
                    <span id="btnText">üöÄ G√©n√©rer</span>
                    <span class="loading" id="loading"><span class="spinner"></span> G√©n√©ration...</span>
                </button>
            </form>
            <div class="results" id="results">
                <div class="result-box">
                    <h3>‚úÖ Document g√©n√©r√© !</h3>
                    <p id="resultInfo" style="margin-bottom:12px;color:#666"></p>
                    <a href="#" class="download-btn" id="downloadBtn">üì• T√©l√©charger Word</a>
                    <button class="download-btn new-btn" id="newBtn">üîÑ Nouveau</button>
                </div>
                <div class="preview" id="preview"></div>
            </div>
        </div>
    </div>
    <script>
        let currentType='fiche';
        document.querySelectorAll('.type-btn').forEach(btn=>{
            btn.addEventListener('click',()=>{
                document.querySelectorAll('.type-btn').forEach(b=>b.classList.remove('active'));
                btn.classList.add('active');
                currentType=btn.dataset.type;
                document.querySelectorAll('.conditional').forEach(f=>f.classList.remove('visible'));
                document.getElementById(currentType+'Fields').classList.add('visible');
                const t={fiche:'üìã G√©n√©rer la fiche',projet:'üìä G√©n√©rer le projet',grille:'üìù G√©n√©rer la grille'};
                document.getElementById('btnText').textContent=t[currentType];
            });
        });
        document.getElementById('generatorForm').addEventListener('submit',async(e)=>{
            e.preventDefault();
            const btn=document.getElementById('submitBtn'),btnText=document.getElementById('btnText'),loading=document.getElementById('loading');
            btn.disabled=true;btnText.style.display='none';loading.style.display='flex';
            try{
                const fd={typeDocument:currentType,niveau:document.getElementById('niveau').value,aps:document.getElementById('aps').value,
                    objectif:document.getElementById('objectif')?.value||'',numeroSeance:document.getElementById('numeroSeance')?.value||'1',
                    niveauEleves:document.getElementById('niveauEleves')?.value||'moyen',nombreSeances:document.getElementById('nombreSeances')?.value||'10',
                    typeGrille:document.getElementById('typeGrille')?.value||'observation',classe:document.getElementById('classe')?.value||'',
                    nomProf:document.getElementById('nomProf')?.value||'',etablissement:document.getElementById('etablissement')?.value||'',
                    anneeScolaire:document.getElementById('anneeScolaire')?.value||''};
                const resp=await fetch('/api/generer-fiche',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(fd)});
                const data=await resp.json();
                if(data.success){
                    const blob=new Blob([data.html],{type:'application/msword'}),url=URL.createObjectURL(blob);
                    document.getElementById('downloadBtn').href=url;
                    document.getElementById('downloadBtn').download=data.filename;
                    const tn={fiche:'Fiche',projet:'Projet',grille:'Grille'};
                    document.getElementById('resultInfo').textContent=`${tn[currentType]} - ${fd.aps} - ${fd.niveau}`;
                    document.getElementById('preview').innerHTML=data.ficheDetaillee||'<p style="color:#888;text-align:center">Aper√ßu dans le fichier Word</p>';
                    document.querySelector('.form-section').style.display='none';
                    document.getElementById('results').classList.add('visible');
                }else{alert('Erreur: '+(data.error||'Inconnue'));}
            }catch(err){alert('Erreur: '+err.message);}
            finally{btn.disabled=false;btnText.style.display='inline';loading.style.display='none';}
        });
        document.getElementById('newBtn').addEventListener('click',()=>{
            document.querySelector('.form-section').style.display='block';
            document.getElementById('results').classList.remove('visible');
        });
        document.addEventListener('DOMContentLoaded',()=>{
            const s=localStorage.getItem('profeps_formData');
            if(s){try{const d=JSON.parse(s);
                if(d.niveau)document.getElementById('niveau').value=d.niveau;
                if(d.aps)document.getElementById('aps').value=d.aps;
                if(d.objectif)document.getElementById('objectif').value=d.objectif;
                if(d.nomProf)document.getElementById('nomProf').value=d.nomProf;
                if(d.etablissement)document.getElementById('etablissement').value=d.etablissement;
                if(d.anneeScolaire)document.getElementById('anneeScolaire').value=d.anneeScolaire;
                if(d.numeroSeance)document.getElementById('numeroSeance').value=d.numeroSeance;
                localStorage.removeItem('profeps_formData');
                if(d.autoGenerate)setTimeout(()=>document.getElementById('generatorForm').dispatchEvent(new Event('submit')),500);
            }catch(e){localStorage.removeItem('profeps_formData');}}
        });
    </script>
</body>
</html>
