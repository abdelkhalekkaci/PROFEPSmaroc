<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de fiches EPS | Cr√©ez votre fiche en 2 minutes - Prof EPS</title>
    <meta name="description" content="G√©n√©rez automatiquement des fiches de pr√©paration EPS pour handball, football, gymnastique, athl√©tisme. Conforme aux OP 2007-2009 du Maroc.">
    <link rel="icon" type="image/png" href="/images/prof_eps.png">
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        :root {
            --primary: #c1272d;
            --primary-dark: #a01f24;
            --secondary: #006233;
            --secondary-dark: #004d28;
            --text-primary: #1a1a2e;
            --text-secondary: #4a4a68;
            --text-light: #6b7280;
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-card: #ffffff;
            --border: #e2e8f0;
            --border-light: #f1f5f9;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1);
            --radius: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-2xl: 24px;
            --radius-full: 9999px;
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-2xl: 3rem;
            --spacing-3xl: 4rem;
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-display: 'Plus Jakarta Sans', var(--font-primary);
            --transition: all 0.3s ease;
        }
        
        .generator-hero {
            padding: 120px var(--spacing-xl) var(--spacing-xl);
            background: linear-gradient(135deg, rgba(193, 39, 45, 0.05) 0%, rgba(0, 98, 51, 0.05) 100%);
            text-align: center;
        }
        .generator-section { padding: var(--spacing-2xl) var(--spacing-xl) var(--spacing-3xl); }
        .generator-container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: var(--spacing-2xl);
            align-items: start;
        }
        .form-panel {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-light);
            position: sticky;
            top: 100px;
        }
        .form-panel-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--border-light);
        }
        .form-panel-header h2 { font-family: var(--font-display); font-size: 1.5rem; color: var(--text-primary); margin-bottom: var(--spacing-xs); }
        .form-panel-header p { color: var(--text-secondary); font-size: 0.9375rem; }
        .form-section { margin-bottom: var(--spacing-lg); }
        .form-section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        .info-fields { display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-sm); }
        .form-group { margin-bottom: var(--spacing-md); }
        .form-group.full-width { grid-column: 1 / -1; }
        .form-label { display: block; font-size: 0.875rem; font-weight: 500; color: var(--text-primary); margin-bottom: var(--spacing-xs); }
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md);
            font-family: var(--font-primary);
            font-size: 0.9375rem;
            color: var(--text-primary);
            background: var(--bg-primary);
            border: 2px solid var(--border);
            border-radius: var(--radius-lg);
            transition: var(--transition);
        }
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--bg-card);
            box-shadow: 0 0 0 4px rgba(193, 39, 45, 0.1);
        }
        .form-textarea { min-height: 80px; resize: vertical; }
        .generate-btn {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-xl);
            font-size: 1rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        .generate-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(193, 39, 45, 0.4); }
        .generate-btn:disabled { opacity: 0.7; cursor: not-allowed; }
        .generate-btn.loading { background: var(--text-light); }
        
        /* Bouton retour */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-secondary);
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: var(--spacing-md);
        }
        .back-btn:hover {
            color: var(--primary);
            border-color: var(--primary);
            background: rgba(193, 39, 45, 0.05);
        }
        
        .result-panel {
            background: var(--bg-card);
            border-radius: var(--radius-2xl);
            padding: var(--spacing-xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-light);
            min-height: 600px;
        }
        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-lg);
            padding-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--border-light);
        }
        .result-title { font-family: var(--font-display); font-size: 1.25rem; color: var(--text-primary); }
        .result-actions { display: flex; gap: var(--spacing-sm); }
        .result-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 0.875rem;
            font-weight: 500;
            border-radius: var(--radius);
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            cursor: pointer;
            border: none;
        }
        .result-btn-primary { background: var(--secondary); color: white; }
        .result-btn-primary:hover { background: var(--secondary-dark); }
        .result-btn-secondary { background: var(--bg-primary); color: var(--text-primary); border: 1px solid var(--border); }
        .result-btn-secondary:hover { border-color: var(--primary); color: var(--primary); }
        .empty-state { text-align: center; padding: var(--spacing-3xl) var(--spacing-xl); }
        .empty-state-icon { font-size: 5rem; margin-bottom: var(--spacing-lg); opacity: 0.5; }
        .empty-state h3 { font-size: 1.5rem; color: var(--text-primary); margin-bottom: var(--spacing-sm); }
        .empty-state p { color: var(--text-secondary); max-width: 400px; margin: 0 auto; }
        .fiche-content { display: none; }
        .fiche-content.show { display: block; }
        .fiche-detail { line-height: 1.4; font-size: 0.875rem; }
        .fiche-detail h2, .fiche-detail h3 { color: var(--text-primary); font-size: 1.1rem; margin-top: var(--spacing-md); margin-bottom: var(--spacing-sm); padding-bottom: var(--spacing-xs); border-bottom: 2px solid var(--primary); }
        .fiche-detail h4 { color: var(--primary); font-size: 0.95rem; margin-top: var(--spacing-sm); margin-bottom: var(--spacing-xs); }
        .fiche-detail p { margin: var(--spacing-xs) 0; color: var(--text-secondary); }
        .fiche-detail ul, .fiche-detail ol { margin: var(--spacing-xs) 0; padding-left: var(--spacing-lg); }
        .fiche-detail li { margin: 2px 0; color: var(--text-secondary); }
        .fiche-detail strong { color: var(--text-primary); }
        .fiche-detail hr { margin: var(--spacing-lg) 0; border: none; border-top: 2px solid var(--border-light); }
        .fiche-detail pre { background: var(--bg-secondary); padding: var(--spacing-md); border-radius: var(--radius); overflow-x: auto; font-size: 0.75rem; line-height: 1.4; }
        .fiche-detail table { width: 100%; border-collapse: collapse; margin: var(--spacing-sm) 0; }
        .fiche-detail th, .fiche-detail td { border: 1px solid var(--border); padding: var(--spacing-sm); text-align: left; font-size: 0.8rem; }
        .fiche-detail th { background: var(--bg-secondary); font-weight: 600; }
        
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .loading-overlay.show { display: flex; }
        .loading-content { text-align: center; color: white; }
        .loading-spinner { width: 80px; height: 80px; margin: 0 auto 20px; position: relative; }
        .loading-spinner::before, .loading-spinner::after { content: ''; position: absolute; border-radius: 50%; }
        .loading-spinner::before { width: 100%; height: 100%; border: 4px solid transparent; border-top-color: #006233; border-right-color: #006233; animation: spin 1s linear infinite; }
        .loading-spinner::after { width: 60%; height: 60%; top: 20%; left: 20%; border: 4px solid transparent; border-bottom-color: #c1272d; border-left-color: #c1272d; animation: spin 0.8s linear infinite reverse; }
        .loading-text { font-size: 1.25rem; font-weight: 600; margin-bottom: 10px; }
        .loading-subtext { font-size: 0.9rem; opacity: 0.8; }
        .loading-progress { width: 200px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin: 20px auto 0; overflow: hidden; }
        .loading-progress-bar { height: 100%; background: linear-gradient(90deg, #c1272d, #006233, #c1272d); background-size: 200% 100%; animation: progress 2s ease-in-out infinite; }
        @keyframes progress { 0% { width: 0%; } 50% { width: 70%; } 100% { width: 100%; } }
        .spinner { width: 20px; height: 20px; border: 2px solid rgba(255, 255, 255, 0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Auto-generation notice */
        .auto-notice {
            background: linear-gradient(135deg, rgba(0, 98, 51, 0.1), rgba(193, 39, 45, 0.1));
            border: 1px solid var(--secondary);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: 0.875rem;
            color: var(--secondary);
        }
        .auto-notice.hidden { display: none; }
        .auto-notice-icon { font-size: 1.5rem; }
        
        @media (max-width: 1024px) { .generator-container { grid-template-columns: 1fr; } .form-panel { position: static; } }
        @media (max-width: 600px) { .info-fields { grid-template-columns: 1fr; } .result-header { flex-direction: column; gap: var(--spacing-md); align-items: flex-start; } .result-actions { width: 100%; } .result-btn { flex: 1; justify-content: center; } }
        
        .footer-social a { display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: rgba(255,255,255,0.1); border-radius: 50%; transition: all 0.3s ease; }
        .footer-social a:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }
        .footer-social svg { width: 20px; height: 20px; fill: white; }
        .social-icon { display: inline-flex; align-items: center; gap: 0.5rem; }
        .social-icon svg { width: 18px; height: 18px; fill: currentColor; }

        /* Overrides requested for UI consistency */
        .navbar { background-color: #c1272d !important; border-bottom: 1px solid rgba(255,255,255,0.1) !important; box-shadow: 0 4px 20px rgba(193, 39, 45, 0.2); }
        .navbar .nav-link { color: rgba(255,255,255,0.9) !important; }
        .navbar .nav-link:hover, .navbar .nav-link.active { color: #ffffff !important; opacity: 1; }
        .navbar .nav-link.active::after { background: #ffffff !important; }
        .navbar .nav-toggle span { background: #ffffff !important; }
        .navbar .nav-logo img { filter: brightness(0) invert(1); }
        
        .footer { background: #006233 !important; }
        .footer-bottom { border-top: 1px solid rgba(255,255,255,0.2) !important; }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">G√©n√©ration en cours...</div>
            <div class="loading-subtext" id="loadingStatus">Analyse des param√®tres...</div>
            <div class="loading-progress"><div class="loading-progress-bar"></div></div>
        </div>
    </div>

    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="/images/prof_eps.png" alt="Prof EPS" style="height: 60px;">
            </a>
            <div class="nav-menu" id="navMenu">
                <a href="index.html" class="nav-link">Accueil</a>
                <a href="generateur.html" class="nav-link active">G√©n√©rateur</a>
                <a href="blog.html" class="nav-link">Blog</a>
                <a href="a-propos.html" class="nav-link">√Ä propos</a>
                <a href="contact.html" class="nav-link">Contact</a>
                <a href="generateur.html" class="nav-cta"><span>‚ú®</span> Cr√©er une fiche</a>
            </div>
            <button class="nav-toggle" id="navToggle" aria-label="Menu"><span></span><span></span><span></span></button>
        </div>
    </nav>

    <section class="generator-hero">
        <span class="section-badge">‚ú® G√©n√©rateur</span>
        <h1 class="hero-title" style="margin-bottom: var(--spacing-md);">Cr√©ez votre <span>fiche EPS</span></h1>
        <p class="hero-description" style="max-width: 700px; margin: 0 auto;">Remplissez le formulaire ci-dessous et laissez notre IA g√©n√©rer une fiche p√©dagogique compl√®te.</p>
    </section>

    <section class="generator-section">
        <div class="generator-container">
            <div class="form-panel">
                <a href="index.html" class="back-btn">
                    <span>‚Üê</span> Retour √† l'accueil
                </a>
                
                <div class="form-panel-header">
                    <h2>üìù Param√®tres</h2>
                    <p>Configurez votre fiche de s√©ance</p>
                </div>
                
                <!-- Notice de g√©n√©ration automatique -->
                <div class="auto-notice hidden" id="autoNotice">
                    <span class="auto-notice-icon">‚ö°</span>
                    <span>G√©n√©ration automatique en cours depuis l'accueil...</span>
                </div>
                
                <form id="generateForm">
                    <div class="form-section">
                        <div class="form-section-title"><span>üë§</span> Informations professeur</div>
                        <div class="info-fields">
                            <div class="form-group">
                                <label class="form-label">Nom du professeur</label>
                                <input type="text" class="form-input" id="nomProf" placeholder="M. / Mme...">
                            </div>
                            <div class="form-group">
                                <label class="form-label">√âtablissement</label>
                                <input type="text" class="form-input" id="etablissement" placeholder="Lyc√©e / Coll√®ge...">
                            </div>
                            <div class="form-group full-width">
                                <label class="form-label">Ann√©e scolaire</label>
                                <input type="text" class="form-input" id="anneeScolaire" value="2024-2025">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <div class="form-section-title"><span>‚öôÔ∏è</span> Param√®tres de la s√©ance</div>
                        
                        <div class="form-group">
                            <label class="form-label">Niveau scolaire *</label>
                            <select class="form-select" id="niveau" required>
                                <option value="">-- S√©lectionner --</option>
                                <optgroup label="Coll√®ge (OP 2009)">
                                    <option value="1AC">1√®re Ann√©e Coll√®ge</option>
                                    <option value="2AC">2√®me Ann√©e Coll√®ge</option>
                                    <option value="3AC">3√®me Ann√©e Coll√®ge</option>
                                </optgroup>
                                <optgroup label="Lyc√©e (OP 2007)">
                                    <option value="TC">Tronc Commun</option>
                                    <option value="1AB">1√®re Ann√©e Bac</option>
                                    <option value="2AB">2√®me Ann√©e Bac</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Activit√© sportive (APS) *</label>
                            <select class="form-select" id="aps" required>
                                <option value="">-- S√©lectionner --</option>
                                <optgroup label="Sports collectifs">
                                    <option value="Handball">ü§æ Handball</option>
                                    <option value="Football">‚öΩ Football</option>
                                    <option value="Basketball">üèÄ Basketball</option>
                                    <option value="Volleyball">üèê Volleyball</option>
                                </optgroup>
                                <optgroup label="Athl√©tisme">
                                    <option value="Course de vitesse">üèÉ Course de vitesse</option>
                                    <option value="Course de relais">üèÉ‚Äç‚ôÇÔ∏è Course de relais</option>
                                    <option value="Saut en longueur">ü¶ò Saut en longueur</option>
                                    <option value="Saut en hauteur">‚¨ÜÔ∏è Saut en hauteur</option>
                                    <option value="Lancer de poids">üí™ Lancer de poids</option>
                                    <option value="Course de dur√©e">‚è±Ô∏è Course de dur√©e</option>
                                </optgroup>
                                <optgroup label="Gymnastique">
                                    <option value="Gymnastique">ü§∏ Gymnastique au sol</option>
                                </optgroup>
                                <optgroup label="Sports de renvoi">
                                    <option value="Tennis de table">üèì Tennis de table</option>
                                    <option value="Badminton">üè∏ Badminton</option>
                                </optgroup>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Objectif de la s√©ance *</label>
                            <textarea class="form-textarea" id="objectif" required placeholder="Ex: Am√©liorer la capacit√© de l'√©l√®ve √† conserver le ballon"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Num√©ro de la s√©ance</label>
                            <select class="form-select" id="numeroSeance">
                                <option value="1">S√©ance 1</option>
                                <option value="2">S√©ance 2</option>
                                <option value="3">S√©ance 3</option>
                                <option value="4">S√©ance 4</option>
                                <option value="5">S√©ance 5</option>
                                <option value="6">S√©ance 6</option>
                                <option value="7">S√©ance 7</option>
                                <option value="8">S√©ance 8</option>
                                <option value="9">S√©ance 9</option>
                                <option value="10">S√©ance 10</option>
                            </select>
                        </div>
                    </div>
                    
                    <button type="submit" class="generate-btn" id="generateBtn">
                        <span>üöÄ</span>
                        <span>G√©n√©rer la fiche</span>
                    </button>
                </form>
            </div>
            
            <div class="result-panel">
                <div class="empty-state" id="emptyState">
                    <div class="empty-state-icon">üìã</div>
                    <h3>Votre fiche appara√Ætra ici</h3>
                    <p>Remplissez le formulaire et cliquez sur "G√©n√©rer la fiche".</p>
                </div>
                
                <div class="fiche-content" id="ficheContent">
                    <div class="result-header">
                        <h2 class="result-title">üìã Fiche de pr√©paration</h2>
                        <div class="result-actions">
                            <button class="result-btn result-btn-primary" id="downloadBtn" style="display: none;">
                                <span>üì•</span> T√©l√©charger Word
                            </button>
                            <button class="result-btn result-btn-secondary" id="downloadPdfBtn" style="display: none;">
                                <span>üìÑ</span> T√©l√©charger PDF
                            </button>
                        </div>
                    </div>
                    <div class="fiche-detail" id="ficheDetail"></div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="footer-grid">
            <div class="footer-brand">
                <a href="index.html" class="nav-logo">
                    <img src="/images/prof_eps.png" alt="Prof EPS" style="height: 60px; filter: brightness(0) invert(1);">
                </a>
                <p>Le premier g√©n√©rateur intelligent de fiches p√©dagogiques pour les professeurs d'EPS au Maroc.</p>
            </div>
            <div>
                <h4 class="footer-title">Navigation</h4>
                <div class="footer-links">
                    <a href="index.html">Accueil</a>
                    <a href="generateur.html">G√©n√©rateur</a>
                    <a href="blog.html">Blog</a>
                    <a href="a-propos.html">√Ä propos</a>
                    <a href="contact.html">Contact</a>
                </div>
            </div>
            <div>
                <h4 class="footer-title">Ressources</h4>
                <div class="footer-links">
                    <a href="article-op.html">Orientations P√©dagogiques</a>
                    <a href="article-eval.html">√âvaluation en EPS</a>
                    <a href="article-securite.html">S√©curit√© en EPS</a>
                </div>
            </div>
            <div>
                <h4 class="footer-title">Contact</h4>
                <div class="footer-links">
                    <a href="mailto:epsprof.assistance@gmail.com">epsprof.assistance@gmail.com</a>
                    <a href="https://www.facebook.com/profepsma" target="_blank">Facebook</a>
                    <a href="https://www.instagram.com/profepsma/" target="_blank">Instagram</a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p class="footer-copyright">¬© 2025 Prof EPS. Tous droits r√©serv√©s.</p>
        </div>
    </footer>

    <script>
        // Elements
        const generateForm = document.getElementById('generateForm');
        const generateBtn = document.getElementById('generateBtn');
        const emptyState = document.getElementById('emptyState');
        const ficheContent = document.getElementById('ficheContent');
        const ficheDetail = document.getElementById('ficheDetail');
        const downloadBtn = document.getElementById('downloadBtn');
        const downloadPdfBtn = document.getElementById('downloadPdfBtn');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const loadingStatus = document.getElementById('loadingStatus');
        const navbar = document.getElementById('navbar');
        const navToggle = document.getElementById('navToggle');
        const navMenu = document.getElementById('navMenu');
        const autoNotice = document.getElementById('autoNotice');

        let currentHtml = null;
        let currentFilename = null;

        // Navbar
        window.addEventListener('scroll', () => {
            navbar.classList.toggle('scrolled', window.scrollY > 50);
        });
        navToggle.addEventListener('click', () => navMenu.classList.toggle('active'));

        // Loading
        const loadingMessages = ['Analyse des param√®tres...', 'Consultation des OP...', 'G√©n√©ration des situations...', 'Finalisation...'];
        function showLoading() {
            loadingOverlay.classList.add('show');
            let i = 0;
            return setInterval(() => {
                if (i < loadingMessages.length) loadingStatus.textContent = loadingMessages[i++];
            }, 2000);
        }
        function hideLoading(interval) {
            clearInterval(interval);
            loadingOverlay.classList.remove('show');
        }

        // ========================================
        // V√âRIFIER SI DONN√âES VIENNENT DE L'ACCUEIL
        // ========================================
        function checkForAutoGenerate() {
            const savedData = localStorage.getItem('profeps_formData');
            
            if (savedData) {
                try {
                    const formData = JSON.parse(savedData);
                    
                    // Pr√©-remplir le formulaire
                    if (formData.niveau) document.getElementById('niveau').value = formData.niveau;
                    if (formData.aps) document.getElementById('aps').value = formData.aps;
                    if (formData.objectif) document.getElementById('objectif').value = formData.objectif;
                    if (formData.nomProf) document.getElementById('nomProf').value = formData.nomProf;
                    if (formData.etablissement) document.getElementById('etablissement').value = formData.etablissement;
                    if (formData.anneeScolaire) document.getElementById('anneeScolaire').value = formData.anneeScolaire;
                    if (formData.numeroSeance) document.getElementById('numeroSeance').value = formData.numeroSeance;
                    
                    // Supprimer les donn√©es de localStorage
                    localStorage.removeItem('profeps_formData');
                    
                    // Si autoGenerate est true, lancer automatiquement
                    if (formData.autoGenerate) {
                        autoNotice.classList.remove('hidden');
                        
                        // Petit d√©lai pour que l'utilisateur voie que tout est pr√™t
                        setTimeout(() => {
                            generateFiche();
                        }, 500);
                    }
                    
                } catch (e) {
                    console.error('Erreur parsing localStorage:', e);
                    localStorage.removeItem('profeps_formData');
                }
            }
        }

        // Fonction de g√©n√©ration
        async function generateFiche() {
            const niveau = document.getElementById('niveau').value;
            const aps = document.getElementById('aps').value;
            const objectif = document.getElementById('objectif').value;
            const numeroSeance = document.getElementById('numeroSeance').value;
            const nomProf = document.getElementById('nomProf').value;
            const etablissement = document.getElementById('etablissement').value;
            const anneeScolaire = document.getElementById('anneeScolaire').value;

            if (!niveau || !aps || !objectif) {
                alert('Veuillez remplir tous les champs obligatoires (*)');
                autoNotice.classList.add('hidden');
                return;
            }

            generateBtn.disabled = true;
            generateBtn.innerHTML = '<div class="spinner"></div><span>G√©n√©ration...</span>';
            const loadingInterval = showLoading();

            try {
                console.log('üöÄ Envoi de la requ√™te...');
                const response = await fetch('/api/generer-fiche', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ niveau, aps, objectif, numeroSeance, nomProf, etablissement, anneeScolaire })
                });

                console.log('üì• R√©ponse:', response.status);
                const data = await response.json();
                console.log('üìã Donn√©es:', data);

                hideLoading(loadingInterval);
                autoNotice.classList.add('hidden');

                if (data.success) {
                    emptyState.style.display = 'none';
                    ficheContent.classList.add('show');

                    let htmlContent = data.ficheDetaillee
                        .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                        .replace(/\n/g, '<br>')
                        .replace(/---/g, '<hr>');

                    ficheDetail.innerHTML = htmlContent;
                    currentHtml = data.html;
                    currentFilename = data.filename;

                    downloadBtn.style.display = 'flex';
                    downloadPdfBtn.style.display = 'flex';

                    ficheContent.scrollIntoView({ behavior: 'smooth', block: 'start' });
                } else {
                    throw new Error(data.error || 'Erreur lors de la g√©n√©ration');
                }
            } catch (error) {
                console.error('Erreur:', error);
                hideLoading(loadingInterval);
                autoNotice.classList.add('hidden');
                alert('Erreur: ' + error.message);
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<span>üöÄ</span><span>G√©n√©rer la fiche</span>';
            }
        }

        // Form submit
        generateForm.addEventListener('submit', (e) => {
            e.preventDefault();
            generateFiche();
        });

        // Download Word
        downloadBtn.addEventListener('click', () => {
            if (currentHtml && currentFilename) {
                const blob = new Blob([currentHtml], { type: 'application/msword' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = currentFilename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        });

        // Download PDF
        downloadPdfBtn.addEventListener('click', () => {
            if (currentHtml) {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(currentHtml);
                printWindow.document.close();
                printWindow.onload = () => printWindow.print();
            }
        });

        // ========================================
        // INITIALISATION AU CHARGEMENT
        // ========================================
        document.addEventListener('DOMContentLoaded', () => {
            checkForAutoGenerate();
        });
    </script>
</body>
</html>
